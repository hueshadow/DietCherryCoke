---
import { getCollection, render } from 'astro:content';
import ArticleLayout from '../../layouts/ArticleLayout.astro';
import JsonLd from '../../components/JsonLd.astro';

export async function getStaticPaths() {
  const articles = await getCollection('articles', ({ data }) => !data.draft);
  return articles.map((article) => ({
    params: { slug: article.id },
    props: { article },
  }));
}

const { article } = Astro.props;
const { Content } = await render(article);
const { title, description, publishDate, modifiedDate, author, image, category } = article.data;

const breadcrumbs = [
  { label: category.charAt(0).toUpperCase() + category.slice(1) },
  { label: title },
];
---

<ArticleLayout
  title={title}
  description={description}
  image={image?.src}
  publishDate={publishDate.toISOString()}
  modifiedDate={modifiedDate?.toISOString()}
  author={author}
  breadcrumbs={breadcrumbs}
>
  <header class="mb-8">
    <h1 class="text-3xl font-bold sm:text-4xl">{title}</h1>
    <p class="mt-3 text-text-secondary">{description}</p>
    <div class="mt-4 flex items-center gap-4 text-sm text-text-muted">
      <time datetime={publishDate.toISOString()}>
        {publishDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
      </time>
      {author && <span>by {author}</span>}
    </div>
  </header>

  <div class="prose prose-invert max-w-none">
    <Content />
  </div>

  <JsonLd
    slot="schema"
    type="Article"
    data={{
      title,
      description,
      image: image?.src,
      publishDate: publishDate.toISOString(),
      modifiedDate: modifiedDate?.toISOString(),
      author,
      url: Astro.url.href,
    }}
  />
</ArticleLayout>
